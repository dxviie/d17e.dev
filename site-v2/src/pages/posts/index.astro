---
import {SITE_TITLE, SITE_DESCRIPTION} from '../../consts';
import {getCollection} from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import BaseHead from "../../components/BaseHead.astro";
import MediaAsset from "../../components/MediaAsset.astro";

const posts = (await getCollection('posts')).sort(
  (a, b) => (b.data.publishDate?.valueOf() || 0) - (a.data.publishDate?.valueOf() || 0),
);
---

<!doctype html>
<html lang="en">
<head>
  <title>{SITE_TITLE} | d17e.dev - Posts</title>
  <BaseHead title={`${SITE_TITLE} | Posts`} description={SITE_DESCRIPTION}/>
  <style>
      main {
          display: flex;
          flex-direction: column;
          margin: 3rem auto 0;
          width: 1960px;
          max-width: calc(100% - 2rem);
          padding: 2rem 0;
      }

      .page-title {
          width: 100%;
          max-width: 960px;
          align-self: center;
          font-family: 'nudica_monobold', serif;
          margin-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
          padding-bottom: 0.5rem;
      }

      ul {
          justify-content: center;
          display: flex;
          flex-wrap: wrap;
          gap: 2rem;
          list-style-type: none;
          margin: 0;
          padding: 0;
      }

      ul li {
          width: calc(33% - 1rem);
          background: rgba(var(--gray-light), 0.05);
          border-radius: 12px;
          overflow: hidden;
          transition: all 0.3s ease;
      }

      ul li:hover {
          transform: translateY(-5px);
          box-shadow: var(--box-shadow);
      }

      .media-container {
          position: relative;
          width: 100%;
          aspect-ratio: 1;
          overflow: hidden;
      }

      .title-overlay {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          padding: 1rem;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
          color: white;
          z-index: 1;
      }

      .title-overlay h2 {
          margin: 0;
          font-family: 'nudica_monobold', serif;
          color: white;
          padding: 0.2rem 0.5rem;
          font-size: 1.5rem;
          text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      }

      ul li:first-child .title-overlay h2 {
          font-size: 2rem;
      }

      .title-overlay .date {
          background-color: var(--color);
          color: var(--bg-color);
          padding: 0.2rem 0.5rem;
          font-family: 'nudica_monolight', serif;
          margin: 0.5rem 0 0;
          font-size: 0.9rem;
      }

      ul li a {
          display: block;
          text-decoration: none;
          color: var(--color);
          position: relative;
      }

      .content {
          padding: 1rem;
          display: none; /* Hide the original content area since we're using overlay */
      }

      @media (max-width: 1650px) {
          ul li {
              width: calc(50% - 1rem);
          }

          ul {
              gap: 1rem;
          }

          .title-overlay h2 {
              font-size: 1.2rem;
          }
      }

      @media (max-width: 768px) {
          ul {
              gap: 1rem;
          }

          ul li {
              width: 100%;
          }

          .title-overlay h2 {
              font-size: 1.2rem;
          }
      }
  </style>
</head>
<body>
<Header/>
<main>
  <h1 class="page-title">Posts</h1>
  <section>
    <ul>
      {
        posts.map((post) => (
          <li>
            <a href={`/posts/${post.data.slug}/`}>
              {post.data.cover && (
                <div class="media-container">
                  <MediaAsset
                    id={post.data.cover.id}
                    title={post.data.cover.title}
                    alt={post.data.cover.title || post.data.title}
                    type={post.data.cover.type}
                    filenameDownload={post.data.cover.filenameDownload}
                    width={800}
                    height={450}
                  />

                  <div class="title-overlay">
                    {post.data.publishDate && (
                      <span class="date">
                        <FormattedDate date={post.data.publishDate}/>
                      </span>
                    )}
                    <h2>{post.data.title}</h2>
                  </div>
                </div>
              )}
              <div class="content">
                {post.data.publishDate && (
                  <span class="date">
                    <FormattedDate date={post.data.publishDate}/>
                  </span>
                )}
                <h2 class="title">{post.data.title}</h2>
              </div>
            </a>
          </li>
        ))
      }
    </ul>
  </section>
</main>
<Footer/>

<script>
  // Add event listeners to start videos on hover
  document.addEventListener('DOMContentLoaded', () => {
    const videos = document.querySelectorAll('video');

    videos.forEach(video => {
      const listItem = video.closest('li');

      if (listItem) {
        listItem.addEventListener('mouseenter', () => {
          video.play();
        });

        listItem.addEventListener('mouseleave', () => {
          video.pause();
          // Reset to first frame
          video.currentTime = 0.1;
        });
      }
    });
  });
</script>
</body>
</html>